//
// Copyright 2017 Christian Reitwiessner
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
// 2019 OKIMS
//      ported to solidity 0.6
//      fixed linter warnings
//      added requiere error messages
//
//
// SPDX-License-Identifier: GPL-3.0

import "../lib/pairing.sol";

pragma solidity ^0.5.17;

contract DropWalletVerifier {
    using Pairing for *;
    struct VerifyingKey {
        Pairing.G1Point alfa1;
        Pairing.G2Point beta2;
        Pairing.G2Point gamma2;
        Pairing.G2Point delta2;
        Pairing.G1Point[] IC;
    }
    struct Proof {
        Pairing.G1Point A;
        Pairing.G2Point B;
        Pairing.G1Point C;
    }
    function verifyingKey() internal pure returns (VerifyingKey memory vk) {
        vk.alfa1 = Pairing.G1Point(15335046661320124292905035647473127509866742556799957537393831346285102693127,20680079041773898215691568567745477138877933005294966282214515257262158223306);
        vk.beta2 = Pairing.G2Point([3568689028688573868995920093723292420246885966932167056583584626468088574871,16572806956827616158980549445834353967944308865810623123575771565769586741784], [5761958416950272891340940250950176129333966102015225525890184316726644975,8459134749510515866174683705762265391270287772895735752416833656715049479825]);
        vk.gamma2 = Pairing.G2Point([11559732032986387107991004021392285783925812861821192530917403151452391805634,10857046999023057135944570762232829481370756359578518086990519993285655852781], [4082367875863433681332203403145435568316851327593401208105741076214120093531,8495653923123431417604973247489272438418190587263600148770280649306958101930]);
        vk.delta2 = Pairing.G2Point([9899895863079726145591971102031532892216218462667782039551880829459760034143,12214086253949083204720073754042535913050383480828735982548928851526797811064], [1093752348999522264756913927762120679424463170635388474852331406918312904348,16190975018304622702602887853685507290592546511981049567846165077807019108636]);
        vk.IC = new Pairing.G1Point[](106);
        vk.IC[0] = Pairing.G1Point(12089098512321721730423168290727626625205456847647095244228469209575207013020,4725188299311427094577320292666316913919853080807286563052534903192586618230);
        vk.IC[1] = Pairing.G1Point(252005278624881015280347423156722302110766597511180046103538853063059429775,17595381005276474404010655609915381809906599440200087574671884078606155346664);
        vk.IC[2] = Pairing.G1Point(2089140425276820280883983926011947436996096735533018280792920863794386732688,1069301225114909223871867602561916826665132175300736765783108828940735091876);
        vk.IC[3] = Pairing.G1Point(16070454198027089411466704205648418643785913683911940023424024075105540398405,12284905273397944094507093688270589099206751284877302346844017675885616732540);
        vk.IC[4] = Pairing.G1Point(21631273078273279249561574356688533378254175045897143345465628031307755374367,21596389514219012855691205421230558332901945136737781713404377007855546510941);
        vk.IC[5] = Pairing.G1Point(19736826483472784821954778378978067751744455664948115699293594548814887175114,8824447225640272912866236315060024293224278565426809437216080391574874366053);
        vk.IC[6] = Pairing.G1Point(10792678119966450638793381359753280032840615554138667852289888191869243352191,5365673804647361640731795712256766521337129611405016944756740429151457416039);
        vk.IC[7] = Pairing.G1Point(18709945745429034564107947786873059107281290834124082286413915129235529014106,9034485900046932001446575352597872959698709463509012204138701132020574575913);
        vk.IC[8] = Pairing.G1Point(10170708403267126851821070547903411522460903971268670728571565638619240517939,586023794109391963897668636299485161877864150991586719422732201487498548242);
        vk.IC[9] = Pairing.G1Point(14576588284263463130079996557735601592283259953573509231986603115447474905484,20838066363280151399639034976905033405619448197139806784582183100391858411148);
        vk.IC[10] = Pairing.G1Point(7809622458497212661439740388486969656309725706938578816926415902196188643709,18440197921391869462627617354436268408329108280155619933145498690497559363557);
        vk.IC[11] = Pairing.G1Point(6485015767708701170592514942486784643732368742929787775904528141028451272279,993086984997485027362877370587127404539357835138667034526910113539252380274);
        vk.IC[12] = Pairing.G1Point(16959897132198220367182510089788734463815675914392416895821047869331997374652,6852218801124398693682375217212645906251897592819152713362706565146930609138);
        vk.IC[13] = Pairing.G1Point(2980494825853812038926776699504671831079535365407573714998749487115868657022,8086236355564987177752603248775531249661214624516974595559304480115389864337);
        vk.IC[14] = Pairing.G1Point(20351802317113447961921408407614909593233142652579158773973653850915807101731,19744259875217559839985010223557846821783962763654938283508657982616442575365);
        vk.IC[15] = Pairing.G1Point(1123314906672066807886644110471923640541095896230466181174604634643487332543,8979473690235238284801082089924096349056871752703078796013451562907457080073);
        vk.IC[16] = Pairing.G1Point(21344821066085573000268565026994500328171926864543085622673843785226074860660,17510779319328918233566938833125143712716554470037719217252860332046488132374);
        vk.IC[17] = Pairing.G1Point(1228556786715390350346030263603202523165453661355028590243908722678293596882,7434005979416882025750412250830724759775415736900968898283099481778064806366);
        vk.IC[18] = Pairing.G1Point(6303310742071878791132109573467922069451766954837782882847594389922410987429,9037264483001161410251517636700617651450006737543083149219745771201075154478);
        vk.IC[19] = Pairing.G1Point(6743785899182130142131914160701944141027923826473050715496920876177177123476,11345867254920354559858275430053107581321391514602059184720646233540409351081);
        vk.IC[20] = Pairing.G1Point(9061842129727472279092646849447217313040400802789594269685983331575588464127,12925954069591230265095007262449239100513589176290058169638749793401781726321);
        vk.IC[21] = Pairing.G1Point(20985540443181383172372862766011995067528678214257456755278566383599449988195,15873167092783723218093121438249589302188363680299067817429547613585978340964);
        vk.IC[22] = Pairing.G1Point(18713135468477625558463718784957197430801787079235637333015251928369520610067,831075347155066004121128301611242837499699905226415541326669380506698619159);
        vk.IC[23] = Pairing.G1Point(4822686286960301062147271312185769614106486686971723688399567774279490973440,4841379738336647764889137386980029979676726202747672317327757989514282063993);
        vk.IC[24] = Pairing.G1Point(6614567608712892913030487193784648956037592046715757025079667343295241003897,11860304165328673688427546578178652917820112574278047522176086225465940700926);
        vk.IC[25] = Pairing.G1Point(11613286989861990850903713370393439485259783349048034595044810227629040838799,11671709099884714504934411106849391271674169652288724327526859661428884705777);
        vk.IC[26] = Pairing.G1Point(2280708515021055318618348955605568645992616015910831794572757961755209849250,4556358776410548167697480590845568349072906821398135066097514564416446679235);
        vk.IC[27] = Pairing.G1Point(20259323168108768170339740153972658061096090024860540270971062602634779719958,18220480547929268365620083869702660077574272703648472430789737367263292050062);
        vk.IC[28] = Pairing.G1Point(7989107343833348330188772072608839960478289153864510952536327487056715327213,15610497552403040382982430621734459426543679153412895454668758657310298159608);
        vk.IC[29] = Pairing.G1Point(5381404356669849738263691450896792030748028993670205004444309094693566228264,3302503717035424966928679454899995803423186825676242165150955506641927474760);
        vk.IC[30] = Pairing.G1Point(14112017743263445526957762133625063521527173643312086904593692288789216611958,21578281559720617474421951934120630858610710145457082700523733306070796244503);
        vk.IC[31] = Pairing.G1Point(11182453717786666315057383397052194045715751617490267493746607729257748183944,4052726183199003568828304281145896147666728992478149851204867340429147747892);
        vk.IC[32] = Pairing.G1Point(5010194207799164303923444673094118427984836553964714678962495114750104995133,15542969927897359879048314286381555841515000704394969944627724744948709943668);
        vk.IC[33] = Pairing.G1Point(3153611200209294759461294606267180808219555765282779548022246945468693653431,11556988202485081199743487022111950632519111106939083502855589878101751366929);
        vk.IC[34] = Pairing.G1Point(2581679675306072588357581330577332406143743128403351868448117831702138792061,6639486555123733917727053904545224845376938789479129788811959598835966655187);
        vk.IC[35] = Pairing.G1Point(6214462449274005551954790678370462961631691774394414787609211647580736099468,266740705206077880809791417516664716775422753371979183448967551882570436173);
        vk.IC[36] = Pairing.G1Point(20329248189196824670737060771336370538395144983654670318182639751703042258286,2641157200003114817616323879443773100333142783913709603847578667414586875599);
        vk.IC[37] = Pairing.G1Point(941713181691772314599701412688890902092987751709171300972556432114922557463,8275344692200569511771078051559787663308610635884675812862897374825340855522);
        vk.IC[38] = Pairing.G1Point(9951464346047799129921779456760263635496913819081933207845542423293084937377,10924208350056371455273210429584332251486912053166689007466182765902946430409);
        vk.IC[39] = Pairing.G1Point(20742393393256361623837963413279940998469952650552746464196544881142701631735,13395839059979357846930285125780181267772683095843236801291763612734795834284);
        vk.IC[40] = Pairing.G1Point(21715298766079230698586592697993561519249961324847250603474784693472100196905,3632713072571119247576729633007201148307021154360620721605662004236377727243);
        vk.IC[41] = Pairing.G1Point(10801315124308933470781316463659258980022388384014188708230607722992390210907,3722463294767481919272403396410564954459600413155865342155961285774685070590);
        vk.IC[42] = Pairing.G1Point(858340956810959233625660211788891612518183342203590184852367359159493997527,17339506289339767325142306451405391321202839427111528532103402228121554004275);
        vk.IC[43] = Pairing.G1Point(8617457364058138524039819257974656259281594114518571076539836360383622710217,4713954062285778022766327021874262394488131179996685931724277843490339554558);
        vk.IC[44] = Pairing.G1Point(856180323055239295695241585591480412984889424520626985987389649181172231038,6492531298307334115274481753008100510640601852736128929845069578516407028210);
        vk.IC[45] = Pairing.G1Point(21156851135944287621470389087854260400764228430143113641108504759712327660691,19472433947949338996754908763351234990949509757675167942010102647179203650531);
        vk.IC[46] = Pairing.G1Point(4045748957894815720375094772414323151478109781587147980117777583566907332093,20871183628983573144988414717421390754291837496331606442131434750908991481056);
        vk.IC[47] = Pairing.G1Point(20463850414071452149687707542887649836180966022880437657435812447607577803496,16910262602811934100743001698123498990574601698458650230876356932307668007733);
        vk.IC[48] = Pairing.G1Point(17177397832269055044162522582670728616924682293298017110874028455753609144080,19518697110818465596151241483600601186967038607345304604708906390030701470522);
        vk.IC[49] = Pairing.G1Point(15361255362757025806387929365439066944072915837154622885476829149413039494645,354186820891973359073191778229975831137453496629779856526066245051779716838);
        vk.IC[50] = Pairing.G1Point(11533347583809319876926343820264212151623016072466573066132300427690031739455,4922808819286913150690840942053547024724205951432035874816214471481793428347);
        vk.IC[51] = Pairing.G1Point(18648089065163564867058188466377897249696044981111135133143831860869064249815,5500824942586641652674870347563821451056514172723057138559170112225949176557);
        vk.IC[52] = Pairing.G1Point(19105695232336066667460611634937968693417787936434261777775966135947229009795,13883165480844181797789901663969713263258230434310334478515162718608825386271);
        vk.IC[53] = Pairing.G1Point(6405850544896591838219898799371649804751272118316641586649770692430994453406,19545217227337377648859336098893127093146727785735722384323447667937765915849);
        vk.IC[54] = Pairing.G1Point(11244453421918967033822828976908801019596440529606115623564690789477834690482,5337540341806536976688987204198150209970675206299039755022118067760222897502);
        vk.IC[55] = Pairing.G1Point(13911645863591390185390775362310344005677170020663433608682454379956258212154,12409651084314493960075349080081330304306263378511919269394130668213662321167);
        vk.IC[56] = Pairing.G1Point(12993676479691835695691235883995195050079381135868529186102950996502435733940,2628550999984842305927991736542185515861416742789139368370851207215421997503);
        vk.IC[57] = Pairing.G1Point(89493734069202943424994898390801873789396398464083251822251255897099917557,17768993572313590701393404442176425376931605740167005961435092177181049723944);
        vk.IC[58] = Pairing.G1Point(551454298208900526029849308295487999591717009317562525094125909400691076495,18057090540073954662556660677740171159745534961297868450332699757198050552496);
        vk.IC[59] = Pairing.G1Point(6049860693764754330773801689588623203215924218231873801014521806268889503281,13235312151582381581461495836214499614102037049627827255814118457065343246666);
        vk.IC[60] = Pairing.G1Point(2661431922209258392956315860714634906585694158913454959974048417284300114178,13566087004176876958954165540199893600426152311936871312307694441120073178747);
        vk.IC[61] = Pairing.G1Point(8552278924632473408850845390074340712262342354681652532735120421459471926048,18890128274248731305830952715382777209389743981261535013419810227464413725959);
        vk.IC[62] = Pairing.G1Point(17660883541422462628212069257395656050111772278245346374154625150897513040319,10576797961951274430986826453265946839988397183854967650193513927139050109870);
        vk.IC[63] = Pairing.G1Point(17634129294464891664372789861590392417301391321498592340509442963744894237654,10962836040813332095652140603542661263415545685066388118587158998991246597286);
        vk.IC[64] = Pairing.G1Point(7052487414439623596307662553954344568946317249014606810661174845248669901535,9165421462267008198707335791154963325902086278488767630522192964776214705103);
        vk.IC[65] = Pairing.G1Point(8376748731389620720282876482674896139383164664491158095027488401793156128878,3109547334677323877964906901171712802451785599030773124567496711078116539058);
        vk.IC[66] = Pairing.G1Point(7447876491985219643959150541760596011833579227034320211759089915327791184046,12852762674533911448656527509177294376575056131380960942371956567277273981926);
        vk.IC[67] = Pairing.G1Point(17324882070361984329257097602840917946772017284064146066027070202259707873340,19649409820695682564172112253176356372824653714371756332634300139170810555534);
        vk.IC[68] = Pairing.G1Point(7556467198754221907057044841578091289836545015470608281258123289409893556007,18772845444931790905967667774279226432742379784791682326595086471616873163093);
        vk.IC[69] = Pairing.G1Point(3481315877686782514282171469978220743048506547924280714985682380280169092722,10743009231344654111390864402530125260440181424233373715565710794351417282542);
        vk.IC[70] = Pairing.G1Point(3978919315495884523775818931073880363157684344476021611661088091975114535205,6958427497695018915059698553207971173861780453548010628563966118610056891821);
        vk.IC[71] = Pairing.G1Point(12949093109764501206659959284833745158594464038358519630630499066223066990626,15445736757900821051197276090763763173170406754107158777441687999948564445296);
        vk.IC[72] = Pairing.G1Point(4048732728142530517302244970522624975464486501413293979337879060703158970228,9548280841655007234802480030842294795410308417130247052612905937038552046950);
        vk.IC[73] = Pairing.G1Point(2080286463809425056249769473165884997635754662280938682570382362324532185176,9681974442256068434125922958905096165813700764925237232860675386175303825220);
        vk.IC[74] = Pairing.G1Point(2472632005076128328949021433503275051547574877890512167906457755363448822238,8244509817095409438586761526871495148830157091127310700464356261542942404517);
        vk.IC[75] = Pairing.G1Point(8087432205999976143132438725883295651394694727729756219874594796646168819428,6857012210807455444801808181780727956225620031535489958188862927591830542096);
        vk.IC[76] = Pairing.G1Point(1258337113943736605929152829369399933591016397673202056131436452108087293241,15068683166071668455348787155517808019108479953129858498122513407428713435995);
        vk.IC[77] = Pairing.G1Point(5592127825991958440336458224460116265369848276294441091411555821408189111448,2579076886937170528093108306473441135448341803366736748672564684288580897565);
        vk.IC[78] = Pairing.G1Point(14051341671996722038910337179160244629933190207150472829628954352590255199577,15506292998710492296004577672916055990473823876510951123101274721510883395018);
        vk.IC[79] = Pairing.G1Point(13626900869987103407440035111532916649469708314994249685559876390734156434815,14045089477303374881142140060317746044083805788526026285408935352095111429232);
        vk.IC[80] = Pairing.G1Point(6107278615588857423476211954461983480392765712201321382221597195624228895734,4328590429604214579457987585286341269367959596065067638039889131968303150429);
        vk.IC[81] = Pairing.G1Point(16945844185596279329070251367828999594066381778189891010564467494709685519816,10730517428372258910531828735835990597143585193953510264793133809815801429941);
        vk.IC[82] = Pairing.G1Point(10477761703813315381450770333441420601414107421525046742036279503912375345714,17796644258660265940554448617595546899078166363879456009574650762043486411049);
        vk.IC[83] = Pairing.G1Point(9782788853378175417803887615453813356049945506303969264437370421928853650253,10751642574689170921083279985939790463204658201943574648658346566532749946127);
        vk.IC[84] = Pairing.G1Point(21808298694276066766812901559270043674736940123550394315278828341751978427412,2364335159028392664795724482889873883242985424712696134561988869999417432511);
        vk.IC[85] = Pairing.G1Point(3422906143126451751591384755815098591979914078915931273674686961815574532492,11912927617763507805540966059029559781548221769281969656630273461359454489528);
        vk.IC[86] = Pairing.G1Point(13088412271572202754607454029050346345939463707790018207731893326195114627236,10788876835063001349631333309455637425376350174990226179231808747069360278373);
        vk.IC[87] = Pairing.G1Point(18744647971460718668988467811023921733780085253116831801831235906748324787731,1555519835043968834952302632291564073710172142642013610632411521849525257679);
        vk.IC[88] = Pairing.G1Point(21826620943788361209866925626119308832194091799586362577227778886527588874014,16726295132275014126857215558254437966059988004020557095881217162876581735700);
        vk.IC[89] = Pairing.G1Point(16919106089402919687731787000446762535809176815153090334102267625072827125315,8752978992780000118296599722024436261914377651234044922109552985471928454282);
        vk.IC[90] = Pairing.G1Point(6128647643905315894925399195610506861952257356194616330439114523559898453277,10507406056690512220553499649156708289881213842449052209311333553452650344797);
        vk.IC[91] = Pairing.G1Point(14024388519018178991524182186682673898909100183266852466378492329066346705577,16217209848899006908885061684462728836521172225323365708976740522996304693673);
        vk.IC[92] = Pairing.G1Point(11111220924400791142165592812405007294546702432100037679711541261871417029715,4108873936169897089582052184776292840186559543454803266980049691723064696508);
        vk.IC[93] = Pairing.G1Point(5499237390880876863245758856641086624508729333398994806966292460372857926015,14720380520718969454027774063115711540117152709470809054608974424592507914931);
        vk.IC[94] = Pairing.G1Point(10076163057799676771553312312576427834097534147474030321490932407324436049321,14801033804934562809984197493858419684431077276437055319944632400680037762203);
        vk.IC[95] = Pairing.G1Point(8118870674069449532750152643136054592200907909990909399307894295723118397242,15156075679725722914209200988620005244295356904483696636727970407616448338026);
        vk.IC[96] = Pairing.G1Point(20208137106329396722608915498551625946076176283705500515480379336480905484796,15798528892498797460483196024749883119795096139776711481152292428575541978207);
        vk.IC[97] = Pairing.G1Point(2882458870207569111631218889396344436619980955943327311264203530037214461186,16822087787889095664896473264267790254771269848248891338796795537298836003371);
        vk.IC[98] = Pairing.G1Point(9280285328714442954663660616770318034747564364710329519270515567775717844463,864146026155234200419765260281829586458167935508391447486049244561424497301);
        vk.IC[99] = Pairing.G1Point(21412166094232872614935150332537840747334256199154814191225095864007759660586,10926062086899059300184247397378694283589630579256984223435221131393795875409);
        vk.IC[100] = Pairing.G1Point(7823222914208786879161695703164968074560619858236523546193257843620802882946,3353428150726172699514895152928553141751003751383053813757057600199779915430);
        vk.IC[101] = Pairing.G1Point(15277151522670462982781571337940062479582356503281095809408539031071025769008,7882260587680556874761345613536228402933636844664478233412954269487169602517);
        vk.IC[102] = Pairing.G1Point(19845159124987032956475816446178125454240382351942211373194437242102893652996,13500345064569539322625855845546307795793457628934281954380853569652869352431);
        vk.IC[103] = Pairing.G1Point(6035831457031455018993859502419366381702858899164600439921782452938171657342,16129674978583691307039436054357362926257602179603196575453648777429959921940);
        vk.IC[104] = Pairing.G1Point(20621961155374662435939997042460020633417142160882031378239147197340347825512,7886914458894465344208654235853770827097554698420282890108544999502329704407);
        vk.IC[105] = Pairing.G1Point(1166268062659183885226805994217979829931909954164133149168154241827376072167,15205723942124069216561696174007225918126070746235270723752650047470855171638);

    }
    function verify(uint[] memory input, Proof memory proof) internal view returns (uint) {
        uint256 snark_scalar_field = 21888242871839275222246405745257275088548364400416034343698204186575808495617;
        VerifyingKey memory vk = verifyingKey();
        require(input.length + 1 == vk.IC.length,"verifier-bad-input");
        // Compute the linear combination vk_x
        Pairing.G1Point memory vk_x = Pairing.G1Point(0, 0);
        for (uint i = 0; i < input.length; i++) {
            require(input[i] < snark_scalar_field,"verifier-gte-snark-scalar-field");
            vk_x = Pairing.addition(vk_x, Pairing.scalar_mul(vk.IC[i + 1], input[i]));
        }
        vk_x = Pairing.addition(vk_x, vk.IC[0]);
        if (!Pairing.pairingProd4(
            Pairing.negate(proof.A), proof.B,
            vk.alfa1, vk.beta2,
            vk_x, vk.gamma2,
            proof.C, vk.delta2
        )) return 1;
        return 0;
    }
    /// @return r  bool true if proof is valid
    function verifyProof(
        uint[2] memory a,
        uint[2][2] memory b,
        uint[2] memory c,
        uint[] memory input
    ) public view returns (bool r) {
        Proof memory proof;
        proof.A = Pairing.G1Point(a[0], a[1]);
        proof.B = Pairing.G2Point([b[0][0], b[0][1]], [b[1][0], b[1][1]]);
        proof.C = Pairing.G1Point(c[0], c[1]);
        uint[] memory inputValues = new uint[](input.length);
        for(uint i = 0; i < input.length; i++){
            inputValues[i] = input[i];
        }
        if (verify(inputValues, proof) == 0) {
            return true;
        } else {
            return false;
        }
    }
}
