//
// Copyright 2017 Christian Reitwiessner
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
// 2019 OKIMS
//      ported to solidity 0.6
//      fixed linter warnings
//      added requiere error messages
//
//
// SPDX-License-Identifier: GPL-3.0

import "../lib/pairing.sol";

pragma solidity ^0.5.17;

contract DepositVerifier {
    using Pairing for *;
    struct VerifyingKey {
        Pairing.G1Point alfa1;
        Pairing.G2Point beta2;
        Pairing.G2Point gamma2;
        Pairing.G2Point delta2;
        Pairing.G1Point[] IC;
    }
    struct Proof {
        Pairing.G1Point A;
        Pairing.G2Point B;
        Pairing.G1Point C;
    }
    function verifyingKey() internal pure returns (VerifyingKey memory vk) {
        vk.alfa1 = Pairing.G1Point(15335046661320124292905035647473127509866742556799957537393831346285102693127,20680079041773898215691568567745477138877933005294966282214515257262158223306);
        vk.beta2 = Pairing.G2Point([3568689028688573868995920093723292420246885966932167056583584626468088574871,16572806956827616158980549445834353967944308865810623123575771565769586741784], [5761958416950272891340940250950176129333966102015225525890184316726644975,8459134749510515866174683705762265391270287772895735752416833656715049479825]);
        vk.gamma2 = Pairing.G2Point([11559732032986387107991004021392285783925812861821192530917403151452391805634,10857046999023057135944570762232829481370756359578518086990519993285655852781], [4082367875863433681332203403145435568316851327593401208105741076214120093531,8495653923123431417604973247489272438418190587263600148770280649306958101930]);
        vk.delta2 = Pairing.G2Point([13733199155635321946501526461862619636799967534671653898543452660104920988368,20292217225243778930778045166008148640195071548791832667524622289246498050397], [10334830576620789281913881975298667357164020158761598252737663350216534010478,1585433990222441652464551026940543125726092010939584773169051180087650263204]);
        vk.IC = new Pairing.G1Point[](104);
        vk.IC[0] = Pairing.G1Point(7334621089682988982950166290399336755742464606720871430871196037282067480603,11983846525864303145996849503351331156811817367215606079907791545076804986950);
        vk.IC[1] = Pairing.G1Point(9336542289426227003630043494372272389377845972177213148294507607312542187428,1084471016060006438418742051599459397743171831408942765227662643792895961194);
        vk.IC[2] = Pairing.G1Point(16759287432620758637052557247808041371420848306571165022848006290180051624762,18518179926285891721045228982819077266693584584849976329304674340409368992416);
        vk.IC[3] = Pairing.G1Point(16083792561116423381590889417838621414673515535710123914382737483238320822117,7057286893345781668926140695148528419661907786812270778940850810462924300913);
        vk.IC[4] = Pairing.G1Point(10273389317753383160560424576265460686027150019319740445282820500138091517172,12941041621978976835650600868598706012925083486673752384107684268248519108993);
        vk.IC[5] = Pairing.G1Point(18286114303870107427650803757777646040064111958818030042420920043956867473146,14983105997730385086165649081012725651834220672988286661077257439466701567031);
        vk.IC[6] = Pairing.G1Point(3132677700810147532656971578657217447946393017394298448814312704294833197008,14251724363590245721273923568471291456840301666013849247843128224294537680373);
        vk.IC[7] = Pairing.G1Point(19868277180851703032069212928310524011353124392475091789757750531089147762292,12024708431176753787030874543110922249696372660598793064009493905386516170451);
        vk.IC[8] = Pairing.G1Point(8816024981339226369624063748074269060619494412298425300166450687098435854905,17186288915768045687582921770744350364712076298515687673593014169404618670365);
        vk.IC[9] = Pairing.G1Point(7051195627729987065755492774672435572815736922279421767385154186433018519549,6871567569393427802278905657070823193223469217022734721775171957172604351321);
        vk.IC[10] = Pairing.G1Point(3375298885550716284774067866188293927623741142760612416606676102043597183617,12437335094536707376091062321167449918560056913516620221365686221939245323450);
        vk.IC[11] = Pairing.G1Point(12422403422704278984170800640563436490412681019202899969269071642950147059719,17518750769245975892541002942266863334711838183192061743583532359950259143522);
        vk.IC[12] = Pairing.G1Point(8140658840324415762282993204991797956460784886248790850030920503695601845436,1227561243433849886588589861258165018522441370730631917978287788490710392462);
        vk.IC[13] = Pairing.G1Point(16874538120631828459190856621897325393719992402883122710924741858464650851835,21684973803319675160353532560922261908478108851405309768766804151651721618001);
        vk.IC[14] = Pairing.G1Point(3092251115990698326336858835223550977677280395912999890965431074695879951514,14655456194338392719726253784206210013070232038303325682321415187239099774445);
        vk.IC[15] = Pairing.G1Point(16512456021912810057969613829546422292805467260108923510288656817905632665774,19766133153584438679757643446330163103992512943101885194807194049896340843813);
        vk.IC[16] = Pairing.G1Point(13968443354020214045420359886268517856141510418858003859881246931984964073995,8705995215780441918783860020585118268036999981147691290664782901521131574242);
        vk.IC[17] = Pairing.G1Point(4475004093150151611348926075904259651455712164727982091054660977573084958077,19352879588065380137975841546548805807503686780900169326463374080403950917838);
        vk.IC[18] = Pairing.G1Point(20540879074367630745313582717481348218540954290479028793334969541540934571088,8678850906833649570004695038297308080167063425738004436781580077532391780880);
        vk.IC[19] = Pairing.G1Point(10601876483759588063456780881239819207866008136532552352308179053092164339331,815341597313949906634368380408635284783707004117546857562621098660922940464);
        vk.IC[20] = Pairing.G1Point(18034930140915567685460391492550627222164361672126477874924980243884322759701,14349903579463604570518572337357962355620685316515175248921254016991539585322);
        vk.IC[21] = Pairing.G1Point(7860699164389768507374757714481213664822201925871417876984016295551127453079,18568807833931159621694661926301256818498316384802750222888990560136599775896);
        vk.IC[22] = Pairing.G1Point(20221798229791067951507647173235492904117891933480087779010908696098663940227,4876007301443326926163377286012290340067425241772088979311574565914673470788);
        vk.IC[23] = Pairing.G1Point(18863078865096635566073617137144664696549908655212733970630684700557203661236,13869973580989142297931369835534480991839514955108534234164393377406577443228);
        vk.IC[24] = Pairing.G1Point(953235919340282696187949707766897223095445491225306696893378603939289871166,19037277476830324049531844051534238861773946609911441184822028920360793577316);
        vk.IC[25] = Pairing.G1Point(20421439796009166483866614877749853257053863169104680482036977186918733875400,19857759552204323715860755286700275838898817571055316615394990311530679935427);
        vk.IC[26] = Pairing.G1Point(9754965685483110004789214935762021429260634248647097524059689090308607697130,16134225145837863958904194830600076498745674885762740415073777126193018286280);
        vk.IC[27] = Pairing.G1Point(1665909583404314301490514860445664947991176423756758447890315320934915374824,1357133690755468501227641618177762532720383147244185417958623140243118323811);
        vk.IC[28] = Pairing.G1Point(21189811840697999560523905559890074559245281514580281499670489802813512653382,16587004330037155935091357193845038948513143036306713959196451808246972395562);
        vk.IC[29] = Pairing.G1Point(3865968086223640583927267926946323874565596045228575624147688130182676864676,8397223520740013495380569075205828932428237219792277574386310038764373893884);
        vk.IC[30] = Pairing.G1Point(7288615659023985002686244150619194893876700051576551079401594897712783580153,19426138079678168973369485234473781001262693519120108433329556637312256281094);
        vk.IC[31] = Pairing.G1Point(913725829207836947188214068654827193555003366032899893643290336243465982937,2435167459129056616562739849240392662535426794873509111354909914534069307526);
        vk.IC[32] = Pairing.G1Point(1176690611469190961171093898370515597286779861807642418242312014644269289573,18887447555448634405151113910402543680809303976514366016203843156247833662468);
        vk.IC[33] = Pairing.G1Point(3165571465303619098749283758338526427781792775847903889459887062085336504513,19488092526432181825390095778930473471242957208481162033509220577873194460778);
        vk.IC[34] = Pairing.G1Point(14894665434185745589879693063156662387933975789480198074747640578710558063428,16177898720404690811642178238774797154671423966853174297419310531824556641887);
        vk.IC[35] = Pairing.G1Point(18214330055246508955026408384050594779956970611795711718595158702111403496403,8986527169584354213411277511695590820118261257263975202379952919672567599242);
        vk.IC[36] = Pairing.G1Point(1116660160061890148791129142883546852416336085836575232928384262258472069334,6333430669737661403373327728159275543924862189162992548787900668611147393489);
        vk.IC[37] = Pairing.G1Point(1690989757486444860718971999947994031865454025272236817204705127915752978665,6810464716940596459889703268710526243489964844532330147478553776377876201012);
        vk.IC[38] = Pairing.G1Point(3260766512127445983702525566725861513184833314604418957489189629357491561944,17310352721283973677668830361963184879267966402519675272253213980234844165505);
        vk.IC[39] = Pairing.G1Point(20903717935856698477107888789681686721762807242302628118103310449782899627493,19152159339672246753411086903822016430480483932796121620331780699132570673554);
        vk.IC[40] = Pairing.G1Point(16060553819939127810689423254270539825249924750327017054753057334649522371319,19504362709659930580513322259349240130230977235747313451876312275806645773752);
        vk.IC[41] = Pairing.G1Point(19605706381853795687936199722617852067720032067794132775040294170381054665033,17111909906479960564922081698767105862753710401879061957370165437679282673114);
        vk.IC[42] = Pairing.G1Point(11502280193657422976372781773870860448306338175138988440341931500787125608289,16102871533047175533363758183136308883550574423695046758340869028465101359005);
        vk.IC[43] = Pairing.G1Point(10700796676046541888349926923861482492268524867247358984169758164157063238615,21833415047498780099363777348544758883038030387409824053027748575648149224311);
        vk.IC[44] = Pairing.G1Point(50692996322404746117132009665827796609257189955181604782219522807961865993,447883936706640277179064109177925404523383523356180971208445941159784160445);
        vk.IC[45] = Pairing.G1Point(20712134066678706004368887810168396799018154365032816517579942631329245283879,20156616163758233825363317360965066095290178364526449520935479636285253711379);
        vk.IC[46] = Pairing.G1Point(487368977837887385637504520826035669356342110635792690695028931906343833679,1344126501387707046333424095610433607918053989320346269208886989953113210276);
        vk.IC[47] = Pairing.G1Point(20250157137557962244376680101122882106919786820284142688424956199720339991231,10880229782462751715203342386037346682343928771435468259612881414551213787124);
        vk.IC[48] = Pairing.G1Point(12798315784529412841408466530440757788142065092949199733671450077916997783484,13135792158661637687158857423381451210175188682774742718470985301968995744308);
        vk.IC[49] = Pairing.G1Point(16128602391935699779351801406409951146553704132672822664087436815169133740292,8350569802563747963671404818508799157334791668923630085614251996493811473791);
        vk.IC[50] = Pairing.G1Point(8825660996091596844425169801330372812554629072961291011252770728364562319218,12950369942741821032594276936339919750718224358788871056635012777860910290508);
        vk.IC[51] = Pairing.G1Point(19028415993624749909222004077405162571924112874950321793950228652921283491837,1262752551664581348558027551870248672517902724803881317528414291623278820953);
        vk.IC[52] = Pairing.G1Point(1663094495160550438198371095701957785643363954548959582703274509336887396280,11772118326147257105994327478023180375745377442087898210313964899117740122031);
        vk.IC[53] = Pairing.G1Point(17138402802029231850008497363282422952133078598493497371598106371787596978867,16087774681567458833952794515084170595929150274025307881697399072309702825967);
        vk.IC[54] = Pairing.G1Point(13418822399722313457815705578148890892398638974719239904077111517175084922317,1629520237362185358450480730817283165722370841931765957959787499679118539835);
        vk.IC[55] = Pairing.G1Point(13783969631962815845334188755816535456864512351196420122579144413045256710659,1417749481280557906436684409907335283554172275952534060139891417877279126358);
        vk.IC[56] = Pairing.G1Point(7803295010270149567020052852800333456576619215293038079510045345607640144677,21793172915256151085136281447856347141057074194686943227470679050775038425309);
        vk.IC[57] = Pairing.G1Point(1974710356749609585350486073328860671419547007913621956899143360731502911203,15437211777511110596165573148533559086967854919345421787185009259982180851724);
        vk.IC[58] = Pairing.G1Point(20024170504773343588598015557792158894762203981921754380389082504642904015399,11975690874475158127641793894525711107267761482165766497943260987533574743456);
        vk.IC[59] = Pairing.G1Point(858252803267218797403096614599791945103717095293231985389745451845186569725,11674040861866335045093917563809410576674760540452221237710864270628630286063);
        vk.IC[60] = Pairing.G1Point(15707913004598435881400731782381861644328381833886523347380924249342556325603,2502117099758072703929117952971716204054548620771385113273746040457703960969);
        vk.IC[61] = Pairing.G1Point(64369120921597373342683623672295302247542363211580587371827253281313293104,14317236571945724938197005216139490671065601497185242047083739861553482701521);
        vk.IC[62] = Pairing.G1Point(2907424994517636711946602803762205265558508995459799825168291053130613864232,3381707930182530671019107715321997554545150620139192574857762406148295719671);
        vk.IC[63] = Pairing.G1Point(4347127605621173123239087138798376544108525621053805503097604358239421917650,2488672294202670470996565680910527051740002110818545123747673628120600853998);
        vk.IC[64] = Pairing.G1Point(17384681829354003275214318314155630915691368260921770958080752767670246253790,13235617668123984823385574971310594471524042474241624348267526381529726672880);
        vk.IC[65] = Pairing.G1Point(6771210267613730171031762709358329456628484188362626123746469253914677362538,17762491713019107995496501848833933255387503088334541118949259100742482932002);
        vk.IC[66] = Pairing.G1Point(5471672482889563258402840150945711141448748972560673425553907469741025054652,17986906381272470860559674698154058455457489905298622535446652545434354104492);
        vk.IC[67] = Pairing.G1Point(5437978719326689833023306932943869721473350440426679954323682745521217157763,12732275025993478467314546649638981190770370122159555550906500307783183039347);
        vk.IC[68] = Pairing.G1Point(784630013419909674607209217640765497898359810502205318459034260714548464269,3821429195634687127165221430616550541059829995507755961172539726657311352780);
        vk.IC[69] = Pairing.G1Point(304527553573381668224405323453541036570196869420529895404528785043536371419,4712732341624472412297991537766629948784337106913971950621726314677796943862);
        vk.IC[70] = Pairing.G1Point(1416668391978492269962131625812763616144098003766742290039063700423299871941,19286972460143445195335035008707072105268701702236728742606838229561598340549);
        vk.IC[71] = Pairing.G1Point(6862677939938795300067080534064270491824938866638159500963459833031620134779,7387029527501771735958197400734470016235714441296440531654077106380643958764);
        vk.IC[72] = Pairing.G1Point(1991050801289620508057687982792847313304943126375018428969995166709455366952,69837369663707431688131422430498380123840402355418120969947800181702232494);
        vk.IC[73] = Pairing.G1Point(5508570498454844367373037207050982710456947034415630261425417862207879131378,5162652995613108362139007923392117417074170355943282625642852093262683102069);
        vk.IC[74] = Pairing.G1Point(19223408144344086253168450323489422247482234522518759090182364757102556406358,8213981529231211685112511743085236744865135570170693821342767077072301997513);
        vk.IC[75] = Pairing.G1Point(14213959658082761313734199996628717496636951758042318560046570150911213502242,19727331637585255970716691220402864946458020558445470507880744747758506478577);
        vk.IC[76] = Pairing.G1Point(13373481324628965681743629955584370421979837773005255437193815028851776324941,3116642517360781717795515261753754944794334003021597051712721180030595812323);
        vk.IC[77] = Pairing.G1Point(2683963236930689927930158458639030393547455134079321050509105404947523767931,15527707135626609027475978136334737110041235259985992201532383050652292982912);
        vk.IC[78] = Pairing.G1Point(20519983686756500626421092988212618447478102179355866967541569011710220570107,20653082935480365988624408579834210407959940865830589725124145312804685458259);
        vk.IC[79] = Pairing.G1Point(13598278292120560787749736513996352447271007338125323891524169162528888591588,9337579445121695188551427404319707381952923161521538572210932129476768591275);
        vk.IC[80] = Pairing.G1Point(20489362667135850964368213202768686294271881373557595190577814674241304470212,9076881334257722068736491586848817584618958025466509341982765215495109484559);
        vk.IC[81] = Pairing.G1Point(11283072504117002524872736709151360453376545895796704719586973989582826153034,16224312267670251477165814705604796477770656076699602713638482253448476127019);
        vk.IC[82] = Pairing.G1Point(21534212618953355608586971119594390289780278922197269116437129942971556667379,11959892162312786374634071958838052079445637108986909391588376291221013248196);
        vk.IC[83] = Pairing.G1Point(18714245648763884122627597876262309584344474673317453751172443839485165804775,19054964709869189562486899935857639879191373537760821328948847720051957344727);
        vk.IC[84] = Pairing.G1Point(17859470520682206849000585755382331481264342984647456909155737627324240177630,8292708799509922711632388031722379472326047101545483876154272999801094857587);
        vk.IC[85] = Pairing.G1Point(405102279342828943379187446972326388420493631065516309368282273184827219991,10270478345363729833985176058086919480256097291952025508371280526731346222261);
        vk.IC[86] = Pairing.G1Point(4975705750223080487943419430272794488184595036876563936911683065945150986310,12351399883989407458820467234358196422228180188934214309951204363372458127820);
        vk.IC[87] = Pairing.G1Point(13748612574218358713176892607218436804699721371425557815562410573067614170322,13202226525669036470974788474848484053290544065791023243379340605308810781513);
        vk.IC[88] = Pairing.G1Point(4068706119988896734041585856494123846271844301811199329376116544446286605691,9856225132537008483212180545980195763790766865456953583575118628447612125702);
        vk.IC[89] = Pairing.G1Point(12054462493362248948659107446464227979185657145274456668129201399434771138820,16580949157618116495940041105063162629593053971241088431033402672406321504398);
        vk.IC[90] = Pairing.G1Point(19690853689510313975705196173476908025086314253081346536610180400675795046651,21549856694605750054493363189186366449448615633055502320687161373273550690103);
        vk.IC[91] = Pairing.G1Point(14007844156041721925157619636310599409591416021833136818483509244024553226432,12568615625438584885480694343226003066177197724428649240049737878810889991491);
        vk.IC[92] = Pairing.G1Point(19537670300667501820040561523423736761355441634529366011942730891308236716060,3562650570336862674606609389071715308553135394448956726213949923839835232115);
        vk.IC[93] = Pairing.G1Point(16881780219044602357749335049592495208660130850149253018449498605966784011560,421611785293915267931073455784209677878710405484477645940547956088349431061);
        vk.IC[94] = Pairing.G1Point(8696581682301173939523864316844638124248307711327869834446733647172035949349,8417348002336715206664887593473390554382692257423252932716128614750361773105);
        vk.IC[95] = Pairing.G1Point(4552117448051446299750407307492078166977945475000178534586473565049924980381,8542820260871630154481179518412293899348146207884285519871876284706262784184);
        vk.IC[96] = Pairing.G1Point(11256911116344340348988958809936540490853241540354078589403036860744584641461,994652754102197314978975984301847156806323858549031911732872678188835809734);
        vk.IC[97] = Pairing.G1Point(16467947495499545083707522057600221951954334362887931424048077763298548235833,15134479845955171658122483108835128121138905461692438262038683586056238253549);
        vk.IC[98] = Pairing.G1Point(9531714891980560354892180847989232914822501944178181896574992553473260128087,9634466511922939897772650643481471153679920446857551314679683707399731519038);
        vk.IC[99] = Pairing.G1Point(15562598586729416222633863896869725274409772363781913046633509748538511127790,16191112319241206848412844064473158698266436270061508559090328093495400965418);
        vk.IC[100] = Pairing.G1Point(3883376413216423591492710386566439375036079301006197587614967434599510982573,14468673934609474762573123049037971292233493418409217677332684501319765771544);
        vk.IC[101] = Pairing.G1Point(462259485589040367221464046071630746271114636484941507537156514175434628659,6658193981075647387454367728283127099744437288735941156000867037547827581353);
        vk.IC[102] = Pairing.G1Point(21773663135988551782653794282180746227202591801806388398995253431747070403460,247802971791504144068245166255191419262559403543768242011851377473913287127);
        vk.IC[103] = Pairing.G1Point(6561471241321092287132139414148488602236835537939440040181799774712978764803,4306795165489734654698692038132013085060831049818668523479895146177202230234);

    }
    function verify(uint[] memory input, Proof memory proof) internal view returns (uint) {
        uint256 snark_scalar_field = 21888242871839275222246405745257275088548364400416034343698204186575808495617;
        VerifyingKey memory vk = verifyingKey();
        require(input.length + 1 == vk.IC.length,"verifier-bad-input");
        // Compute the linear combination vk_x
        Pairing.G1Point memory vk_x = Pairing.G1Point(0, 0);
        for (uint i = 0; i < input.length; i++) {
            require(input[i] < snark_scalar_field,"verifier-gte-snark-scalar-field");
            vk_x = Pairing.addition(vk_x, Pairing.scalar_mul(vk.IC[i + 1], input[i]));
        }
        vk_x = Pairing.addition(vk_x, vk.IC[0]);
        if (!Pairing.pairingProd4(
            Pairing.negate(proof.A), proof.B,
            vk.alfa1, vk.beta2,
            vk_x, vk.gamma2,
            proof.C, vk.delta2
        )) return 1;
        return 0;
    }
    /// @return r  bool true if proof is valid
    function verifyProof(
        uint[2] memory a,
        uint[2][2] memory b,
        uint[2] memory c,
        uint[] memory input
    ) public view returns (bool r) {
        Proof memory proof;
        proof.A = Pairing.G1Point(a[0], a[1]);
        proof.B = Pairing.G2Point([b[0][0], b[0][1]], [b[1][0], b[1][1]]);
        proof.C = Pairing.G1Point(c[0], c[1]);
        uint[] memory inputValues = new uint[](input.length);
        for(uint i = 0; i < input.length; i++){
            inputValues[i] = input[i];
        }
        if (verify(inputValues, proof) == 0) {
            return true;
        } else {
            return false;
        }
    }
}
